(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},q={}.hasOwnProperty,r=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};n=function(){function a(){}return a.prototype.setAttributes=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(d?a.setAttribute(c,d):void 0);return e},a.prototype.setStyles=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a.style[c]=""+d+"px");return e},a.prototype.clearActiveCells=function(a){var b,c,d,e,f,g,h,i,j;if(f=a.redCells,c=a.activeCells,f.length>0){for(d=g=0,i=f.length;i>g;d=++g)e=f[d],null!=e&&e.makeInactive();a.redCells=[]}if(c.length>0){for(d=h=0,j=c.length;j>h;d=++h)b=c[d],null!=b&&b.makeInactive(),null!=b&&b.hideControl();a.activeCells=[]}return a.selectionStart=null,a.selectionEnd=null,a.contextMenu.hide(),a.selectedCol?a.selectedCol.makeInactive():void 0},a.prototype.capitalize=function(a){return a.toLowerCase().replace(/\b./g,function(a){return a.toUpperCase()})},a}(),h=function(){function b(b){var c,d,f;if(this.config=b,this.element=document.querySelectorAll(this.config.element||"#gridedit")[0],this.headers=[],this.rows=[],this.cols=[],this.source=this.config.rows,this.redCells=[],this.activeCells=[],this.copiedCells=null,this.selectionStart=null,this.selectionEnd=null,this.selectedCol=null,this.openCell=null,this.state="ready",this.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.topOffset=this.config.topOffset?this.config.topOffset:0,this.cellStyles={activeColor:"#FFE16F",uneditableColor:"#FFBBB3"},this.config.custom){f=this.config.custom;for(c in f)d=f[c],c in this.config.custom&&this.set(c,d);delete this.config.custom}this.config.initialize&&this.init(),this.copiedCellMatrix=null,this.contextMenu=new e(this.config.contextMenuItems,this),this.actionStack=new a(this)}return b.prototype.init=function(){this.config.beforeInit&&this.config.beforeInit(),this.build(),this.events(),this.render(),this.config.afterInit&&this.config.afterInit()},b.prototype.build=function(){var a,b,c,e,f,g,h,i,j,l,m,o,p,q,r;for(j=document.createElement("tr"),q=this.config.cols,c=l=0,o=q.length;o>l;c=++l)b=q[c],a=new d(b,this),this.cols.push(a),j.appendChild(a.element);for(i=document.createElement("thead"),i.appendChild(j),h=document.createElement("tbody"),r=this.source,c=m=0,p=r.length;p>m;c=++m)f=r[c],e=new k(f,this),this.rows.push(e),h.appendChild(e.element);return g=document.createElement("table"),n.prototype.setAttributes(g,{id:"editable-grid","class":this.config.tableClass}),g.appendChild(i),g.appendChild(h),this.tableEl=g},b.prototype.rebuild=function(a){var b,c;if(null==a&&(a=null),b=Object.create(this.config),null!==a)for(c in a)a[c]&&(b[c]=a[c]);return this.destroy(),this.constructor(b)},b.prototype.events=function(){var a,b,c;return c=this,b=c.moveTo,a=c.edit,document.onkeydown=function(d){var e,f,g,h,i,j;if(c.activeCell())if(g=d.keyCode,i=d.shiftKey,f=d.ctrlKey,e=d.metaKey,j=function(a,b){var c;return c=String.fromCharCode(a),b?c:c.toLowerCase()},h=function(){return c.openCell?void 0:c.activeCell().showControl(j(g,i))},e||f){if(g&&91!==g&&92!==g&&c.contextMenu.actionCallbacks.byControl[g])return d.preventDefault(),c.contextMenu.actionCallbacks.byControl[g](d,c)}else switch(g){case 39:if(!c.activeCell().isBeingEdited())return b(c.nextCell());break;case 9:return b(i?c.previousCell():c.nextCell());case 37:return b(c.previousCell());case 38:return b(c.aboveCell());case 40:return b(c.belowCell());case 32:if(!c.openCell)return a(c.activeCell());break;case 13:break;case 16:break;case 17:break;case 91:break;case 8:if(!c.openCell)return d.preventDefault(),c["delete"]();break;case 46:if(!c.openCell)return d.preventDefault(),c["delete"]();break;default:return p.call([96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111],g)>=0&&(g-=48),h()}},window.onresize=function(){return c.openCell?n.prototype.setStyles(c.openCell.control,c.openCell.position()):void 0},window.onscroll=function(){return c.openCell?c.openCell.reposition():void 0},this.tableEl.oncontextmenu=function(){return!1},document.onclick=function(a){var b;return c.isDescendant(a.target)||a.target===(null!=(b=c.activeCell())?b.control:void 0)||c.contextMenu||n.prototype.clearActiveCells(c),c.contextMenu.hide()}},b.prototype.render=function(){return this.element.hasChildNodes()&&(this.element=document.querySelectorAll(this.config.element||"#gridedit")[0]),this.element.appendChild(this.tableEl)},b.prototype.set=function(a,b){return void 0!==a?this.config[a]=b:void 0},b.prototype.getCell=function(a,b){var c;try{return this.rows[a].cells[b]}catch(d){c=d}},b.prototype.activeCell=function(){return this.activeCells.length>1?this.activeCells:this.activeCells[0]},b.prototype.nextCell=function(){var a;return null!=(a=this.activeCell())?a.next():void 0},b.prototype.previousCell=function(){var a;return null!=(a=this.activeCell())?a.previous():void 0},b.prototype.aboveCell=function(){var a;return null!=(a=this.activeCell())?a.above():void 0},b.prototype.belowCell=function(){var a;return null!=(a=this.activeCell())?a.below():void 0},b.prototype.moveTo=function(a,b){var c,d,e,f,g;return a&&(void 0===b&&(b=a.table.activeCell()),d=a.table.getDirection(b,a),a.beforeNavigateTo&&(c=a.beforeNavigateTo(a,b,d)),c!==!1&&(a.isVisible()||(g=a.table.activeCell().address[0],f=a.address[0],e=1,g>f&&(e=-1),window.scrollBy(0,(null!=a?a.position().height:void 0)*e)),a.makeActive())),!1},b.prototype.getDirection=function(a,b){var c,d,e,f,g;return e=a.address[0],g=b.address[0],d=a.address[1],f=b.address[1],e===g?d>f?c="left":f>d?c="right":console.log("Cannot calculate direction going from cell "+a.address+" to cell "+b.address):e>g?c="up":g>e?c="down":console.log("Cannot calculate direction going from cell "+a.address+" to cell "+b.address),c},b.prototype.edit=function(a,b){return null==b&&(b=null),null!==b?null!=a?a.edit(b):void 0:(null!=a&&a.edit(),!1)},b.prototype["delete"]=function(){var a,b,c,d,e;for(d=this.activeCells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.value(""));return e},b.prototype.clearActiveCells=function(){return n.prototype.clearActiveCells(this)},b.prototype.setSelection=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.selectionStart!==this.selectionEnd){for(l=this.activeCells,f=0,h=l.length;h>f;f++)a=l[f],a.removeFromSelection();for(this.activeCells=[],e=function(){o=[];for(var a=m=this.selectionStart.address[0],b=this.selectionEnd.address[0];b>=m?b>=a:a>=b;b>=m?a++:a--)o.push(a);return o}.apply(this),c=function(){p=[];for(var a=n=this.selectionStart.address[1],b=this.selectionEnd.address[1];b>=n?b>=a:a>=b;b>=n?a++:a--)p.push(a);return p}.apply(this),g=0,i=e.length;i>g;g++)for(d=e[g],k=0,j=c.length;j>k;k++)b=c[k],this.rows[d].cells[b].addToSelection()}},b.prototype.data=function(){var a,b,c,d,e,f,g,h,i,j;for(b=[],i=this.rows,e=0,g=i.length;g>e;e++){for(c=i[e],d=[],j=c.cells,f=0,h=j.length;h>f;f++)a=j[f],d.push(a.cellTypeObject.value());b.push(d)}return b},b.prototype.repopulate=function(){var a,b,c,d,e,f;for(e=this.rows,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(function(){var c,d,e,f;for(e=b.cells,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.value(a.source[a.valueKey]));return f}());return f},b.prototype.destroy=function(){var a,b;this.element.removeChild(this.tableEl),b=[];for(a in this)b.push(delete this[a]);return b},b.prototype.isDescendant=function(a){var b;for(b=a.parentNode;null!=b;){if(b===this.tableEl)return!0;b=b.parentNode}return!1},b.prototype.addToStack=function(a){return this.actionStack.addAction(a)},b.prototype.undo=function(){return console.log("table.undo"),this.actionStack.undo()},b.prototype.redo=function(){return console.log("table.redo"),this.actionStack.redo()},b}(),d=function(){function a(a,b){var c,d,e;this.attributes=a,this.table=b,this.id=this.index=this.table.cols.length,this.cellClass=this.attributes.cellClass,this.cells=[],this.element=document.createElement("th"),this.textNode=document.createTextNode(this.attributes.label),this.element.appendChild(this.textNode),e=this.attributes;for(c in e)d=e[c],this[c]=d;delete this.attributes,this.events()}return a.prototype.next=function(){return this.table.cols[this.index+1]},a.prototype.previous=function(){return this.table.cols[this.index-1]},a.prototype.makeActive=function(){return this.element.classList.add("active"),this.table.selectedCol=this},a.prototype.makeInactive=function(){return this.element.classList.remove("active"),this.table.selectedCol=null},a.prototype.events=function(){var a,b;return a=this,b=a.table,this.element.onclick=function(){var c,d,e,f,g;for(n.prototype.clearActiveCells(b),a.makeActive(),f=a.cells,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.addToSelection());return g},this.element.onmousedown=function(c){return 3===c.which?void b.contextMenu.show(c.x,c.y,a.cells[0]):!1}},a}(),k=function(){function a(a,c){var d,e,f,g,h,i;for(this.attributes=a,this.table=c,this.id=this.table.rows.length,this.cells=[],this.index=this.table.rows.length,this.element=document.createElement("tr"),this.editable=!0,n.prototype.setAttributes(this.element,{id:"row-"+this.id}),i=this.table.cols,f=g=0,h=i.length;h>g;f=++g)e=i[f],d=new b(this.attributes[e.valueKey],this),this.cells.push(d),this.table.cols[f].cells.push(d),this.element.appendChild(d.element);delete this.attributes}return a.prototype.below=function(){return this.table.rows[this.index+1]},a.prototype.above=function(){return this.table.rows[this.index-1]},a}(),b=function(){function a(a,b){var c;if(this.originalValue=a,this.row=b,this.id=""+this.row.id+"-"+this.row.cells.length,this.address=[this.row.id,this.row.cells.length],this.index=this.row.cells.length,this.table=this.row.table,this.col=this.table.cols[this.index],this.type=this.col.type,this.meta=this.col,this.editable=this.col.editable!==!1,this.element=document.createElement("td"),this.col.cellClass&&this.element.classList.add(this.col.cellClass),this.valueKey=this.col.valueKey,this.source=this.table.config.rows[this.address[0]],this.initCallbacks(),this.col.style)for(c in this.col.style)this.element.style[c]=this.col.style[c];switch(this.type){case"string":this.cellTypeObject=new m(this);break;case"number":this.cellTypeObject=new j(this);break;case"date":this.cellTypeObject=new f(this);break;case"html":this.cellTypeObject=new i(this);break;case"select":this.cellTypeObject=new l(this)}this.events(this)}return a.prototype.initCallbacks=function(){return this.table.config.beforeEdit&&(this.beforeEdit=this.table.config.beforeEdit),this.table.config.afterEdit&&(this.afterEdit=this.table.config.afterEdit),this.table.config.beforeCellActivate&&(this.beforeActivate=this.table.config.beforeCellActivate),this.table.config.afterCellActivate&&(this.afterActivate=this.table.config.afterCellActivate),this.table.config.beforeControlInit&&(this.beforeControlInit=this.table.config.beforeControlInit),this.table.config.afterControlInit&&(this.afterControlInit=this.table.config.afterControlInit),this.table.config.beforeControlHide&&(this.beforeControlHide=this.table.config.beforeControlHide),this.table.config.afterControlHide&&(this.afterControlHide=this.table.config.afterControlHide),this.table.config.onCellClick&&(this.onClick=this.table.config.onCellClick),this.table.config.beforeCellNavigateTo?this.beforeNavigateTo=this.table.config.beforeCellNavigateTo:void 0},a.prototype.value=function(a,b){var c;return null==a&&(a=null),null==b&&(b=!0),null!==a&&a!==this.element.textContent?(a=this.cellTypeObject.formatValue(a),c=this.value(),this.beforeEdit&&this.beforeEdit(this,c,a),b&&this.table.addToStack({type:"cell-edit",oldValue:c,newValue:a,address:this.address}),this.element.textContent=a,this.cellTypeObject.setValue(a),n.prototype.setStyles(this.control,this.position()),this.afterEdit&&this.afterEdit(this,c,a,this.table.contextMenu.getTargetPasteCell()),a):this.cellTypeObject.render()},a.prototype.makeActive=function(){var a;return this.beforeActivate&&(a=this.beforeActivate(this)),(this.beforeActivate&&a!==!1||!this.beforeActivate)&&(n.prototype.clearActiveCells(this.table),this.showActive(),this.table.activeCells.push(this),this.table.selectionStart=this,this.table.openCell&&this.table.openCell.edit(this.table.openCell.control.value),this.afterActivate)?this.afterActivate(this):void 0},a.prototype.makeInactive=function(){return this.showInactive()},a.prototype.addToSelection=function(){return this.showActive(),this.table.activeCells.push(this)},a.prototype.isActive=function(){return-1!==this.table.activeCells.indexOf(this)},a.prototype.removeFromSelection=function(){return this.showInactive()},a.prototype.showActive=function(){var a;return a=this.element.style.cssText,this.oldCssText=a,this.element.style.cssText=a+" "+("background-color: "+this.table.cellStyles.activeColor+";")},a.prototype.showInactive=function(){return this.element.style.cssText=this.oldCssText},a.prototype.showRed=function(){return this.element.style.cssText="background-color: "+this.table.cellStyles.uneditableColor+";",this.table.redCells.push(this)},a.prototype.showControl=function(a){var b,c;return null==a&&(a=null),this.table.copiedCellMatrix&&this.table.contextMenu.hideBorders(),this.editable?(this.beforeControlInit&&(b=this.beforeControlInit(this)),(this.beforeControlInit&&b!==!1||!this.beforeControlInit)&&(null!==a?(this.control.value=a,c=this.control,setTimeout(function(){return c.focus()},0)):this.cellTypeObject.initControl(),this.control.style.position="fixed",n.prototype.setStyles(this.control,this.position()),this.table.element.appendChild(this.control),this.table.openCell=this,this.afterControlInit)?this.afterControlInit(this):void 0):this.showRed()},a.prototype.hideControl=function(){var a;return null!==this.table.openCell&&(this.beforeControlHide&&(a=this.beforeControlHide(this)),(this.beforeControlHide&&a!==!1||!this.beforeControlHide)&&(this.isControlInDocument()&&this.control.remove(),this.table.openCell=null,this.afterControlHide))?this.afterControlHide(this):void 0},a.prototype.edit=function(a){return null==a&&(a=null),this.editable?null!==a?(this.value(a),this.isBeingEdited()?this.hideControl():this.edit()):(this.showControl(),this.control.focus(),this.cellTypeObject.select()):this.showRed()},a.prototype.position=function(){return this.element.getBoundingClientRect()},a.prototype.isVisible=function(){var a;return a=this.position(),a.top>=this.table.topOffset&&a.bottom<=window.innerHeight},a.prototype.isControlInDocument=function(){return null!==this.control.parentNode},a.prototype.reposition=function(){return n.prototype.setStyles(this.control,this.position())},a.prototype.next=function(){var a;return this.row.cells[this.index+1]||(null!=(a=this.row.below())?a.cells[0]:void 0)},a.prototype.previous=function(){var a;return this.row.cells[this.index-1]||(null!=(a=this.row.above())?a.cells[this.row.cells.length-1]:void 0)},a.prototype.above=function(){var a;return null!=(a=this.row.above())?a.cells[this.index]:void 0},a.prototype.below=function(){var a;return null!=(a=this.row.below())?a.cells[this.index]:void 0},a.prototype.isBefore=function(a){return a.address[0]===this.address[0]&&a.address[1]>this.address[1]},a.prototype.isAfter=function(a){return a.address[0]===this.address[0]&&a.address[1]<this.address[1]},a.prototype.isAbove=function(a){return a.address[0]>this.address[0]&&a.address[1]===this.address[1]},a.prototype.isBelow=function(a){return a.address[0]<this.address[0]&&a.address[1]===this.address[1]},a.prototype.addClass=function(a){return this.element.classList.add(a)},a.prototype.removeClass=function(a){return this.element.classList.remove(a)},a.prototype.isBeingEdited=function(){return null!=this.control.parentNode},a.prototype.events=function(a){var b,c,d,e;return e=a.table,c=e.redCells,b=e.activeCells,this.element.onclick=function(b){var c;return a.onClick&&(c=a.onClick(a,b)),c===!1?!1:void 0},this.element.ondblclick=function(){return a.edit()},this.element.onmousedown=function(b){return 3===b.which?void e.contextMenu.show(b.x,b.y,a):(e.state="selecting",a.makeActive(),!1)},this.element.onmouseover=function(){return"selecting"===e.state?(e.selectionEnd=a,e.setSelection()):void 0},this.element.onmouseup=function(b){return 3!==b.which?(e.selectionEnd=a,e.setSelection(),e.state="ready"):void 0},this.control.onkeydown=function(b){var c,d;switch(c=b.which){case 13:return a.edit(this.value),null!=(d=a.below())?d.makeActive():void 0;case 9:return a.edit(this.value),moveTo(e.nextCell())}},this.cellTypeObject.addControlEvents(a),e.mobile?(d=null,this.element.ontouchstart=function(a){return d=a.changedTouches[0].clientY,n.prototype.clearActiveCells(e),e.openCell?e.openCell.hideControl():void 0},this.element.ontouchend=function(b){var c;return c=b.changedTouches[0].clientY,b.changedTouches.length<2&&c===d?(b.preventDefault(),a.edit()):void 0}):void 0},a}(),e=function(){function a(a,b){var c,d,e,f,g;this.userDefinedActions=a,this.table=b,e=/Mac/.test(navigator.platform)?"Cmd":"Ctrl",this.actionNodes={},this.actionCallbacks={byName:{},byControl:{}},this.borderedCells=[],this.defaultActions={cut:{name:"Cut",shortCut:e+"+X",callback:this.cut},copy:{name:"Copy",shortCut:e+"+C",callback:this.copy},paste:{name:"Paste",shortCut:e+"+V",callback:this.paste},undo:{name:"Undo",shortCut:e+"+Z",callback:this.undo},redo:{name:"Redo",shortCut:e+"+Y",callback:this.redo},fill:{name:"Fill",shortCut:"",hasDivider:!0,callback:this.fill}},this.element=document.createElement("div"),this.element.style.position="fixed",this.menu=document.createElement("ul"),n.prototype.setAttributes(this.menu,{"class":"dropdown-menu",role:"menu","aria-labelledby":"aria-labelledby",style:"display:block;position:static;margin-bottom:5px;"}),f=this.defaultActions;for(d in f)c=f[d],this.userDefinedActions[d]||this.userDefinedActions[d]===!1||this.addAction(c);g=this.userDefinedActions;for(d in g)c=g[d],this.addAction(c);this.element.appendChild(this.menu),this.events(this)}return a.prototype.addDivider=function(){var a;return a=document.createElement("li"),n.prototype.setAttributes(a,{"class":"divider"}),this.menu.appendChild(a)},a.prototype.addAction=function(a){var b,c,d,e,f,g,h;return f=document.createElement("li"),d=document.createElement("div"),h=document.createElement("span"),h.textContent=a.shortCut,h.setAttribute("name",a.name),n.prototype.setAttributes(h,{style:"float: right !important;"}),b=document.createElement("a"),b.textContent=a.name,b.setAttribute("name",a.name),n.prototype.setAttributes(b,{"class":"enabled",tabIndex:"-1"}),a.hasDivider&&this.addDivider(),b.appendChild(h),f.appendChild(b),this.actionNodes[a.name]=f,this.actionCallbacks.byName[a.name]=a.callback,g=a.shortCut,g&&/(ctrl|cmd)/i.test(g)&&(e=g.split("+")[1],c=e.charCodeAt(0),this.actionCallbacks.byControl[c]=a.callback),this.menu.appendChild(f)},a.prototype.show=function(a,b,c){return this.cell=c,c.isActive()||c.makeActive(),this.cells=c.table.activeCells,n.prototype.setStyles(this.element,{left:a,top:b}),this.table.tableEl.appendChild(this.element)},a.prototype.hide=function(){return this.isVisible()?this.table.tableEl.removeChild(this.element):void 0},a.prototype.isVisible=function(){return null!=this.element.parentNode},a.prototype.getTargetPasteCell=function(){return this.table.activeCells.sort(this.sortFunc)[0]},a.prototype.sortFunc=function(a,b){return a.address[0]-b.address[0]},a.prototype.displayBorders=function(){return this.table.copiedCellMatrix?this.table.copiedCellMatrix.displayBorders():void 0},a.prototype.hideBorders=function(){return this.table.copiedCellMatrix?this.table.copiedCellMatrix.removeBorders():void 0},a.prototype.cut=function(a,b){var d,e,f,g,h,i;for(f=b.contextMenu,e=new c(b.activeCells),b.copiedCellMatrix=e,b.addToStack({type:"cut",matrix:e.values,address:[e.lowRow,e.lowCol]}),i=b.activeCells,g=0,h=i.length;h>g;g++)d=i[g],d.value("",!1);return f.displayBorders(),f.hide()},a.prototype.copy=function(a,b){var d;return d=b.contextMenu,b.copiedCellMatrix=new c(b.activeCells),d.displayBorders(),d.hide()},a.prototype.paste=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(g=b.contextMenu,c=g.getTargetPasteCell(),c.editable){for(f=[],i=c.address[0]-1,o=b.copiedCellMatrix.values,k=0,m=o.length;m>k;k++)for(h=o[k],i++,d=c.address[1],f[i]=[],l=0,n=h.length;n>l;l++)j=h[l],e=b.getCell(i,d),e&&e.editable&&(f[i].push(e.value()),e.value(j,!1)),d++;g.hideBorders(),b.addToStack({type:"paste",matrix:f,oldMatrix:b.copiedCellMatrix.values,address:c.address})}return g.hide()},a.prototype.undo=function(a,b){return console.log("start undo"),b.undo()},a.prototype.redo=function(a,b){return console.log("start redo"),b.redo()},a.prototype.fill=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(f=b.contextMenu,c=f.getTargetPasteCell(),c.editable)for(h=c.address[0]-1,n=b.copiedCellMatrix.values,j=0,l=n.length;l>j;j++)for(g=n[j],h++,d=c.address[1],k=0,m=g.length;m>k;k++)i=g[k],e=b.getCell(h,d),console.log(e),e&&e.editable&&e.value(i),d++;return f.hide()},a.prototype.toggle=function(a){var b;return b=this.actionNodes[a].classList,b.toggle("enabled"),b.toggle("disabled")},a.prototype.events=function(a){return this.element.onclick=function(b){var c;return c=b.target.getAttribute("name"),a.actionCallbacks.byName[c](b,a.table)}},a}(),g=function(){function a(a){var b;this.cell=a,b=document.createTextNode(this.cell.originalValue),this.cell.control=document.createElement("input"),this.cell.element.appendChild(b)}return a.prototype.initControl=function(){return this.cell.control.value=this.cell.value()},a.prototype.formatValue=function(a){return a},a.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=a},a.prototype.addControlEvents=function(){},a.prototype.value=function(){return this.cell.value()},a.prototype.render=function(){return this.cell.element.textContent},a.prototype.select=function(){return this.cell.control.select()},a}(),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return r(b,a),b}(g),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return r(b,a),b.prototype.formatValue=function(a){return Number(a)},b.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=Number(a)},b}(g),f=function(a){function b(a){var b;this.cell=a,b=document.createTextNode(this.toDateString(this.cell.originalValue)),this.cell.control=this.toDate(),this.cell.originalValue&&(this.cell.control.valueAsDate=new Date(this.cell.originalValue)),this.cell.element.appendChild(b)}return r(b,a),b.prototype.formatValue=function(a){return a.length>0?this.toDateString(Date.parse(a)):a instanceof Date?this.toDateString(a):0===a.length?(this.cell.control.valueAsDate=null,""):void 0},b.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=new Date(a),this.cell.control.valueAsDate=new Date(a)},b.prototype.initControl=function(){return b.__super__.initControl.call(this),this.cell.control.value=this.toDateInputString(this.cell.value())},b.prototype.addControlEvents=function(a){return this.cell.control.onchange=function(b){return a.edit(b.target.value)}},b.prototype.value=function(){return this.cell.control.valueAsDate},b.prototype.toDateString=function(a){var b;return null==a&&(a=null),a&&""!==a?b=new Date(a):this.value()&&(b=new Date(this.value())),b instanceof Date?("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2)+"-"+b.getFullYear():""},b.prototype.toDate=function(){var a;return a=document.createElement("input"),a.type="date",a.value=this.toDateString(),a},b.prototype.toDateInputString=function(a){var b;return null==a&&(a=null),a&&""!==a?b=new Date(a):this.value()&&(b=new Date(this.value())),b instanceof Date?b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2):""},b}(g),i=function(a){function b(a){var b;this.cell=a,this.cell.htmlContent=this.cell.originalValue,b=this.toFragment(),this.cell.control=document.createElement("input"),this.cell.element.appendChild(b)}return r(b,a),b.prototype.setValue=function(a){var b;return this.cell.htmlContent=a,b=this.toFragment(),this.cell.element.innerHTML="",this.cell.element.appendChild(b)},b.prototype.toFragment=function(){var a,b;return a=document.createElement("div"),b=document.createDocumentFragment(),a.innerHTML=this.cell.htmlContent,b.appendChild(a.firstChild||document.createTextNode("")),b},b.prototype.render=function(){return this.htmlContent},b}(g),l=function(a){function b(a){var b;this.cell=a,b=document.createTextNode(this.cell.originalValue||""),this.cell.control=this.initControl,this.cell.element.appendChild(b)}return r(b,a),b.prototype.initControl=function(){var a,b,c,d,e,f,g,h,i,j;for(d=document.createElement("select"),this.cell.meta.choices||console.log("There is not a 'choices' key in cell "+this.cell.address+" and you specified that it was of type 'select'"),j=this.cell.meta.choices,f=0,h=j.length;h>f;f++){if(a=j[f],c=document.createElement("option"),a instanceof Array)for(b=g=0,i=a.length;i>g;b=++g)e=a[b],0===b&&(c.value=e),1===b&&(c.text=e);else c.value=c.text=a;this.cell.value()===a&&(c.selected=!0),d.add(c)}return d.classList.add("form-control"),this.cell.control=d,this.cell.control.onchange=function(a){return this.cell.edit(a.target.value)}},b.prototype.addControlEvents=function(a){return this.cell.control.onchange=function(b){return a.edit(b.target.value)}},b.prototype.select=function(){},b}(g),c=function(){function a(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.cells=a,k=[],h={},r=this.cells,l=0,o=r.length;o>l;l++)c=r[l],j=c.address[0],e=c.address[1],h[j]?h[j][e]=c.value():(k.push(j),h[j]={},h[j][e]=c.value());for(this.matrix=h,this.rowCount=k.length,k.sort(function(a,b){return Number(a)>Number(b)}),this.lowRow=k[0],this.highRow=k[k.length-1],f=Object.keys(this.matrix[this.lowRow]),this.colCount=f.length,f.sort(function(a,b){return Number(a)>Number(b)}),this.lowCol=f[0],this.highCol=f[this.colCount-1],g=[],m=0,p=k.length;p>m;m++){for(i=k[m],b=[],n=0,q=f.length;q>n;n++)d=f[n],b.push(this.matrix[i][d]);g.push(b)}this.values=g}return a.prototype.displayBorders=function(){var a,b,c,d,e;for(d=this.cells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.addBorder(a));return e},a.prototype.removeBorders=function(){var a,b,c,d,e;for(d=this.cells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.element.style.border="");return e},a.prototype.addBorder=function(a){var b,c;return c=a.address[0],b=a.address[1],this.lowRow===this.highRow?(a.element.style.borderTop="2px dashed blue",a.element.style.borderBottom="2px dashed blue"):c<this.highRow?(a.element.style.borderTop="2px dashed blue",a.element.style.borderBottom="2px dashed blue"):a.element.style.borderBottom="2px dashed blue",this.lowCol===this.highCol?(a.element.style.borderLeft="2px dashed blue",a.element.style.borderRight="2px dashed blue"):b<this.highCol?(a.element.style.borderLeft="2px dashed blue",a.element.style.borderRight="2px dashed blue"):a.element.style.borderRight="2px dashed blue"},a}(),a=function(){function a(a){this.table=a,this.index=-1,this.actions=[]}return a.prototype.getCell=function(a){return this.table.getCell(a.address[0],a.address[1])},a.prototype.addAction=function(a){return console.log("stack: add action"),this.actions.push(a),this.index++},a.prototype.undo=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(console.log("stack: undo action"),console.log("in index: ",this.index),this.index>-1)switch(this.index--,a=this.actions[this.index+1],a.type){case"cell-edit":return b=this.getCell(a),b.value(a.oldValue,!1);case"cut":for(f=a.address[0]-1,l=a.matrix,n=[],h=0,j=l.length;j>h;h++)e=l[h],f++,c=a.address[1],n.push(function(){var a,b,h;for(h=[],a=0,b=e.length;b>a;a++)g=e[a],d=this.table.getCell(f,c),d.value(g,!1),h.push(c++);return h}.call(this));return n;case"paste":for(f=a.address[0]-1,m=a.matrix,o=[],i=0,k=m.length;k>i;i++)e=m[i],f++,c=a.address[1],o.push(function(){var a,b,h;for(h=[],a=0,b=e.length;b>a;a++)g=e[a],d=this.table.getCell(f,c),d.value(g,!1),h.push(c++);return h}.call(this));return o}},a.prototype.redo=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(console.log("stack: redo action"),console.log("in index: ",this.index),this.index<this.actions.length-1)switch(this.index++,a=this.actions[this.index],a.type){case"cell-edit":return b=this.table.getCell(a.address[0],a.address[1]),b.value(a.newValue,!1);case"cut":for(f=a.address[0]-1,l=a.matrix,n=[],h=0,j=l.length;j>h;h++)e=l[h],f++,c=a.address[1],n.push(function(){var a,b,h;for(h=[],a=0,b=e.length;b>a;a++)g=e[a],d=this.table.getCell(f,c),d.value(g,!1),h.push(c++);return h}.call(this));return n;case"paste":for(f=a.address[0]-1,m=a.oldMatrix,o=[],i=0,k=m.length;k>i;i++)e=m[i],f++,c=a.address[1],o.push(function(){var a,b,h;for(h=[],a=0,b=e.length;b>a;a++)g=e[a],d=this.table.getCell(f,c),d.value(g,!1),h.push(c++);return h}.call(this));return o}},a}(),o="undefined"!=typeof exports&&null!==exports?exports:window,o.GridEdit=h}).call(this);